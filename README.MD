etcd-sentinel\
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ§  Lightweight remote etcd health monitor with Splunk/HEC integration

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸš€ What it is

etcd-sentinel is a minimal, zero-agent monitoring script for your etcd clusters.\
It runs from anywhere with SSH access, collects cluster metrics remotely, checks database growth, and can push structured results to Splunk via HTTP Event Collector (HEC).

No agents. No daemons. No containers.\
Just a single Bash script doing one job extremely well.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ’¡ Why you might actually want it

Because etcd is the beating heart of your control plane---and it tends to silently grow until something breaks.\
Most monitoring tools require exporters, sidecars, or Prometheus scraping. etcd-sentinel doesn't.

It's designed for environments where:\
- You can't install extra software on control plane nodes.\
- You still need visibility into etcd DB size and health.\
- You prefer one command and a clean JSON output over yet another dashboard.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
âš™ï¸ What it does

- Connects remotely via SSH to your etcd manager node.\
- Executes `etcdctl --cluster=true endpoint status -w json`.\
- Calculates average and maximum database size across all nodes.\
- Detects the current leader and reports health status.\
- Compares usage against configurable thresholds (in GB).\
- Optionally ships metrics to Splunk in JSON format.\
- Outputs both human-readable and machine-readable summaries.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸª¶ Features at a glance

âœ… Zero installation on target nodes\
âœ… Built-in thresholds and severity evaluation\
âœ… Works with any etcd 3.x cluster\
âœ… Compatible with Splunk, Loki, or any REST ingestion endpoint\
âœ… Pure Bash + jq (portable, audit-friendly, 0 dependencies)\
âœ… Can run as a cronjob or as part of CI/CD pipelines

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ§© Example run

===> Checking ETCD status @ etcd-prod-1 (PROD)
Leader: etcd-prod-2\
Max DB size: 1.74 GB (86%)\
Status: WARNING\
Message: WARNING: etcd DB size approaching limit (86% of 2 GB)
âœ… Sent metrics to Splunk HEC\
ETCD sentinel check completed (exit code: 1)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ›  How to use it

Clone and run:\
git clone <https://github.com/><your-org>/etcd-sentinel.git\
cd etcd-sentinel\
chmod +x etcd-sentinel.sh

Basic check (no Splunk):\
./etcd-sentinel.sh --target etcd-node-01 --env PROD

With Splunk integration:\
./etcd-sentinel.sh --target etcd-node-01 --env PROD --splunk-url "https://splunk.example.com/services/collector/event" --splunk-token "YOUR_TOKEN" --index "cluster-logs"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ” Configuration options

--target â†’ remote node (required)\
--env â†’ environment name (PROD / NOPROD)\
--splunk-url â†’ Splunk HEC endpoint\
--splunk-token â†’ HEC token\
--index â†’ Splunk index name (default: cluster-logs)\
--warn â†’ warning threshold (GB)\
--crit â†’ critical threshold (GB)

Default thresholds:\
NOPROD â†’ warn 3 GB / crit 4 GB\
PROD â†’ warn 1.5 GB / crit 2 GB

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ“Š Splunk integration

Each run emits a structured JSON payload that can be indexed directly in Splunk:

{\
"environment": "PROD",\
"manager": "etcd-prod-1",\
"status": "WARNING",\
"usage_percent": 86,\
"max_db_size_bytes": 1870659584,\
"leader": "etcd-prod-2"\
}

Suggested Splunk fields:\
index = docker_system-logs\
source = etcd-sentinel\
sourcetype = etcd-sentinel-json\
service = etcd_sentinel

This makes it trivial to create dashboards showing size trends, leader rotation, or threshold violations.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ§  Why it's different

etcd-sentinel was built to work under the constraints most people forget:\
air-gapped environments, isolated networks, enterprise clusters with strict change management.

It doesn't assume you can run containers, install exporters, or rely on kube-system scraping.\
It just uses the oldest, most reliable API there is: SSH.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ” Security notes

- Requires only SSH access; no persistent connection or background agent.\
- The only remote command executed is `docker exec` on the etcd container.\
- No secrets stored on disk --- Splunk tokens can be passed as environment variables.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ§ª Exit codes

0 â†’ OK (within limits)\
1 â†’ WARNING (approaching threshold)\
2 â†’ CRITICAL (exceeds threshold)

Perfect for use in automation pipelines or alerting scripts.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ“¦ Roadmap

[ ] JSON export mode (--json)\
[ ] Prometheus textfile exporter\
[ ] Slack / Teams native notifications\
[ ] etcd v3.6 API support\
[ ] Multi-cluster parallel mode

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸªª License

MIT License\
Â© 2025 Marco Gomiero

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\
ğŸ’¬ Tagline

"Born inside a production cluster, open-sourced to help others keep etcd small, stable, and happy."